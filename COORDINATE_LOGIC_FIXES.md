# ğŸ”§ æ ¡å‡†é¡µé¢è½¬æ¢é€»è¾‘ä¿®æ­£

## ğŸš¨ å‘ç°çš„é—®é¢˜

ç»è¿‡ä»”ç»†æ£€æŸ¥ï¼Œæˆ‘å‘ç°äº†æ ¡å‡†é¡µé¢ä¸­çš„å‡ ä¸ª**å…³é”®é€»è¾‘é—®é¢˜**ï¼š

### 1. æ•°æ®æ¥æºä¸ä¸€è‡´ âš ï¸

**é—®é¢˜æè¿°**ï¼š
- æµ‹è¯•åŠŸèƒ½ä½¿ç”¨çš„æ˜¯**åŠ è½½æ–‡ä»¶ä¸­çš„è¾¹ç•Œå’Œç³»æ•°**
- è®¡ç®—åŠŸèƒ½ç”Ÿæˆçš„æ˜¯**å½“å‰è®¡ç®—çš„è¾¹ç•Œå’Œç³»æ•°**
- ä¸¤è€…å¯èƒ½ä¸ä¸€è‡´ï¼Œå¯¼è‡´è½¬æ¢ç»“æœé”™è¯¯

**å…·ä½“è¡¨ç°**ï¼š
```javascript
// âŒ é—®é¢˜ï¼šæµ‹è¯•åŠŸèƒ½ä½¿ç”¨åŠ è½½çš„æ•°æ®
convertModelToHeatmap() {
  const bounds = loadedCalibration.value.modelBounds  // æ¥è‡ªæ–‡ä»¶
}

// âœ… è®¡ç®—åŠŸèƒ½ç”Ÿæˆå½“å‰æ•°æ®
calculateTransformation() {
  modelBounds.value = { ... }  // å½“å‰è®¡ç®—
}
```

### 2. è¾¹ç•Œæ•°æ®ä¸åŒæ­¥ âš ï¸

**é—®é¢˜æè¿°**ï¼š
- ç”¨æˆ·ä¿®æ”¹æ ¡å‡†ç‚¹åï¼Œé‡æ–°è®¡ç®—äº†è½¬æ¢å‚æ•°
- ä½†æµ‹è¯•åŠŸèƒ½ä»ç„¶ä½¿ç”¨æ—§çš„è¾¹ç•Œæ•°æ®
- å¯¼è‡´çƒ­åŠ›å›¾åæ ‡è®¡ç®—é”™è¯¯

### 3. ç›¸å…³æ€§åˆ†ææœªä½¿ç”¨ âš ï¸

**é—®é¢˜æè¿°**ï¼š
- ä»£ç è®¡ç®—äº†åæ ‡è½´ä¸ç»çº¬åº¦çš„ç›¸å…³æ€§
- ç¡®å®šäº†æœ€ä½³æ˜ å°„å…³ç³»ï¼ˆX->ç»åº¦ æˆ– X->çº¬åº¦ï¼‰
- ä½†æ˜¯**æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªç»“æœ**ï¼Œä»ç„¶ä½¿ç”¨å›ºå®šçš„æ˜ å°„

## âœ… ä¿®æ­£æ–¹æ¡ˆ

### 1. ç»Ÿä¸€æ•°æ®æ¥æº

**ä¿®æ­£å‰**ï¼š
```javascript
// æ€»æ˜¯ä½¿ç”¨åŠ è½½çš„æ•°æ®
const bounds = loadedCalibration.value.modelBounds
const coeffs = loadedCalibration.value.affineCoeffs
```

**ä¿®æ­£å**ï¼š
```javascript
// ä¼˜å…ˆä½¿ç”¨å½“å‰è®¡ç®—çš„æ•°æ®ï¼Œå›é€€åˆ°åŠ è½½çš„æ•°æ®
let bounds
if (transformationMatrix.value && transformationMatrix.value.modelBounds) {
  bounds = transformationMatrix.value.modelBounds  // å½“å‰è®¡ç®—çš„
} else if (loadedCalibration.value && loadedCalibration.value.modelBounds) {
  bounds = loadedCalibration.value.modelBounds     // åŠ è½½çš„
} else {
  throw new Error('æœªæ‰¾åˆ°æœ‰æ•ˆçš„è¾¹ç•Œæ•°æ®')
}
```

### 2. ä¿®æ­£çš„å‡½æ•°

#### convertLatLonToModel()
- âœ… ä¼˜å…ˆä½¿ç”¨å½“å‰è®¡ç®—çš„ä»¿å°„å˜æ¢ç³»æ•°
- âœ… å›é€€åˆ°åŠ è½½æ–‡ä»¶ä¸­çš„ç³»æ•°
- âœ… æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

#### convertModelToLatLon()
- âœ… ä¼˜å…ˆä½¿ç”¨å½“å‰è®¡ç®—çš„ä»¿å°„å˜æ¢ç³»æ•°
- âœ… å›é€€åˆ°åŠ è½½æ–‡ä»¶ä¸­çš„ç³»æ•°
- âœ… ä¿æŒä¸æ­£å‘è½¬æ¢çš„ä¸€è‡´æ€§

#### convertModelToHeatmap()
- âœ… ä¼˜å…ˆä½¿ç”¨å½“å‰è®¡ç®—çš„æ¨¡å‹è¾¹ç•Œ
- âœ… å›é€€åˆ°åŠ è½½æ–‡ä»¶ä¸­çš„è¾¹ç•Œ
- âœ… ç¡®ä¿çƒ­åŠ›å›¾åæ ‡çš„å‡†ç¡®æ€§

#### testCoordinateConversion()
- âœ… ä¼˜å…ˆä½¿ç”¨å½“å‰è®¡ç®—çš„åœ°ç†è¾¹ç•Œ
- âœ… å›é€€åˆ°åŠ è½½æ–‡ä»¶ä¸­çš„è¾¹ç•Œ
- âœ… æä¾›é»˜è®¤çš„å…¨çƒèŒƒå›´ä½œä¸ºæœ€åå›é€€

### 3. ç›¸å…³æ€§åˆ†æè¯´æ˜

**ä¿ç•™ç›¸å…³æ€§åˆ†æ**ç”¨äºè¯Šæ–­ï¼Œä½†æ˜ç¡®è¯´æ˜ï¼š
- ä»¿å°„å˜æ¢ä½¿ç”¨æ ‡å‡†å½¢å¼ï¼š`lat = a1*x + b1*z + c1, lon = a2*x + b2*z + c2`
- å®é™…çš„æ˜ å°„å…³ç³»ç”±ä»¿å°„å˜æ¢ç³»æ•°è‡ªåŠ¨ç¡®å®š
- ç›¸å…³æ€§åˆ†æä¸»è¦ç”¨äºç†è§£æ•°æ®ç‰¹å¾

## ğŸ¯ ä¿®æ­£æ•ˆæœ

### 1. æ•°æ®ä¸€è‡´æ€§
- æµ‹è¯•åŠŸèƒ½ç°åœ¨ä½¿ç”¨æœ€æ–°è®¡ç®—çš„å‚æ•°
- é¿å…äº†æ–°æ—§æ•°æ®æ··ç”¨çš„é—®é¢˜
- ç¡®ä¿è½¬æ¢ç»“æœçš„å‡†ç¡®æ€§

### 2. å®æ—¶æ›´æ–°
- ä¿®æ”¹æ ¡å‡†ç‚¹åï¼Œæµ‹è¯•åŠŸèƒ½ç«‹å³ä½¿ç”¨æ–°å‚æ•°
- çƒ­åŠ›å›¾åæ ‡åŸºäºæœ€æ–°çš„è¾¹ç•Œè®¡ç®—
- èŒƒå›´æ£€æŸ¥ä½¿ç”¨æœ€æ–°çš„åœ°ç†è¾¹ç•Œ

### 3. å®¹é”™æ€§
- æä¾›å¤šå±‚å›é€€æœºåˆ¶
- æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
- é¿å…å› æ•°æ®ç¼ºå¤±å¯¼è‡´çš„å´©æºƒ

## ğŸ§ª æµ‹è¯•å»ºè®®

### 1. åŸºæœ¬æµ‹è¯•
1. æ‰“å¼€æ ¡å‡†é¡µé¢ï¼ŒæŸ¥çœ‹é¢„åŠ è½½çš„6ä¸ªæ ¡å‡†ç‚¹
2. ç­‰å¾…è‡ªåŠ¨è®¡ç®—å®Œæˆ
3. æµ‹è¯•åæ ‡ `(31.2382, 121.486697)`
4. éªŒè¯ç»“æœæ˜¯å¦åˆç†

### 2. ä¿®æ”¹æµ‹è¯•
1. ç¼–è¾‘ä»»æ„ä¸€ä¸ªæ ¡å‡†ç‚¹çš„ç»çº¬åº¦
2. ç‚¹å‡»"è®¡ç®—è½¬æ¢å‚æ•°"
3. å†æ¬¡æµ‹è¯•ç›¸åŒåæ ‡
4. éªŒè¯ç»“æœæ˜¯å¦å‘ç”Ÿç›¸åº”å˜åŒ–

### 3. åŠ è½½æµ‹è¯•
1. å¯¼å‡ºå½“å‰æ ¡å‡†æ•°æ®
2. æ¸…ç©ºæ‰€æœ‰æ ¡å‡†ç‚¹
3. åŠ è½½åˆšæ‰å¯¼å‡ºçš„æ–‡ä»¶
4. æµ‹è¯•åæ ‡è½¬æ¢æ˜¯å¦æ­£å¸¸

## ğŸ“Š é¢„æœŸæ”¹è¿›

ä¿®æ­£åçš„ç³»ç»Ÿåº”è¯¥ï¼š

1. **ä¸€è‡´æ€§**ï¼šæµ‹è¯•åŠŸèƒ½å§‹ç»ˆä½¿ç”¨æœ€æ–°çš„è®¡ç®—å‚æ•°
2. **å‡†ç¡®æ€§**ï¼šçƒ­åŠ›å›¾åæ ‡åŸºäºæ­£ç¡®çš„è¾¹ç•Œè®¡ç®—
3. **å®æ—¶æ€§**ï¼šä¿®æ”¹æ ¡å‡†ç‚¹åç«‹å³ç”Ÿæ•ˆ
4. **ç¨³å®šæ€§**ï¼šæä¾›å¤šå±‚æ•°æ®å›é€€æœºåˆ¶

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### æ•°æ®ä¼˜å…ˆçº§
```
å½“å‰è®¡ç®—çš„å‚æ•° > åŠ è½½æ–‡ä»¶çš„å‚æ•° > é»˜è®¤å€¼/é”™è¯¯
```

### è¾¹ç•Œè®¡ç®—
```javascript
// æ¨¡å‹è¾¹ç•Œï¼šåŸºäºå½“å‰æ ¡å‡†ç‚¹è®¡ç®—
modelBounds = {
  minX: Math.min(...points.map(p => p.modelX)),
  maxX: Math.max(...points.map(p => p.modelX)),
  // ...
}

// åœ°ç†è¾¹ç•Œï¼šåŸºäºå½“å‰æ ¡å‡†ç‚¹è®¡ç®—
geoBounds = {
  minLat: Math.min(...points.map(p => p.lat)),
  maxLat: Math.max(...points.map(p => p.lat)),
  // ...
}
```

### ç³»æ•°ä½¿ç”¨
```javascript
// ä¼˜å…ˆçº§ï¼šå½“å‰è®¡ç®— > åŠ è½½æ–‡ä»¶ > é”™è¯¯
const coeffs = transformationMatrix.value?.affineCoeffs || 
               loadedCalibration.value?.affineCoeffs || 
               null
```

---

**é‡è¦**ï¼šè¿™äº›ä¿®æ­£è§£å†³äº†æ•°æ®ä¸ä¸€è‡´çš„æ ¹æœ¬é—®é¢˜ï¼Œç°åœ¨æµ‹è¯•åŠŸèƒ½åº”è¯¥èƒ½æä¾›å‡†ç¡®å’Œå®æ—¶çš„è½¬æ¢ç»“æœï¼
