{
  "calibrationPoints": [
    {
      "name": "校准点1",
      "modelX": -72.40295394451705,
      "modelY": 19.66554549619716,
      "modelZ": 812.9764577390581,
      "color": "#ff4444",
      "description": "",
      "lat": 31.242242,
      "lon": 121.491427
    },
    {
      "name": "校准点2",
      "modelX": 106.19976971292328,
      "modelY": 19.068050175905064,
      "modelZ": 796.4236809332394,
      "color": "#44ff44",
      "description": "",
      "lat": 31.244036,
      "lon": 121.490378
    },
    {
      "name": "校准点3",
      "modelX": -71.62023352807236,
      "modelY": 19.068050175905157,
      "modelZ": 411.37663393355365,
      "color": "#4444ff",
      "description": "",
      "lat": 31.240711,
      "lon": 121.486782
    },
    {
      "name": "校准点4",
      "modelX": -3.9125294271554765,
      "modelY": 19.068050175905196,
      "modelZ": 176.27897770367957,
      "color": "#ffff44",
      "description": "",
      "lat": 31.240478,
      "lon": 121.483794
    },
    {
      "name": "校准点5",
      "modelX": -292.64232281821876,
      "modelY": 19.06805017590515,
      "modelZ": 403.9310224900924,
      "color": "#ff44ff",
      "description": "",
      "lat": 31.238495,
      "lon": 121.487661
    },
    {
      "name": "校准点6",
      "modelX": -288.3651172141807,
      "modelY": 19.0680501759052,
      "modelZ": 160.30996285669252,
      "color": "#44ffff",
      "description": "",
      "lat": 31.237553,
      "lon": 121.484886
    }
  ],
  "transformationMatrix": {
    "modelBounds": {
      "minX": -292.64232281821876,
      "maxX": 106.19976971292328,
      "minY": 19.068050175905064,
      "maxY": 19.66554549619716,
      "minZ": 160.30996285669252,
      "maxZ": 812.9764577390581
    },
    "geoBounds": {
      "minLat": 31.237553,
      "maxLat": 31.244036,
      "minLon": 121.483794,
      "maxLon": 121.491427
    },
    "affineCoeffs": {
      "a1": 0.000010058368001095164,
      "b1": -0.000003897104413334851,
      "c1": 31.239836286743987,
      "a2": -0.00000447792356275678,
      "b2": -0.000011466107186733354,
      "c2": 121.48174634639462
    },
    "pointCount": 6,
    "averageError": 1077.8332218730582,
    "maxError": 1905.6519595993861,
    "method": "affine"
  },
  "modelBounds": {
    "minX": -292.64232281821876,
    "maxX": 106.19976971292328,
    "minY": 19.068050175905064,
    "maxY": 19.66554549619716,
    "minZ": 160.30996285669252,
    "maxZ": 812.9764577390581
  },
  "geoBounds": {
    "minLat": 31.237553,
    "maxLat": 31.244036,
    "minLon": 121.483794,
    "maxLon": 121.491427
  },
  "transformationCode": "// 仿射变换坐标转换（基于6个校准点）\n// 平均误差: 1077.83米\n\n// 模型坐标转经纬度（仿射变换）\nfunction modelCoordsToLatLon(x, z) {\n  const lat = 0.00001006 * x + -0.00000390 * z + 31.23983629\n  const lon = -0.00000448 * x + -0.00001147 * z + 121.48174635\n  return { lat, lon }\n}\n\n// 经纬度转模型坐标（仿射变换逆运算）\nfunction latLonToModelCoords(lat, lon) {\n  // 解线性方程组：\n  // lat = a1*x + b1*z + c1  =>  (lat - c1) = a1*x + b1*z\n  // lon = a2*x + b2*z + c2  =>  (lon - c2) = a2*x + b2*z\n  // 使用克拉默法则求解\n  const det = 0.00001006 * -0.00001147 - -0.00000448 * -0.00000390\n  const latDiff = lat - 31.23983629\n  const lonDiff = lon - 121.48174635\n  const x = (latDiff * -0.00001147 - lonDiff * -0.00000390) / det\n  const z = (lonDiff * 0.00001006 - latDiff * -0.00000448) / det\n  return { x, y: 0, z }\n}\n\n// 模型坐标转热力图坐标 (完全按照buildingsHeatmap.vue的逻辑)\nfunction modelCoordsToHeatmapCoords(x, z, mergedGeometryBounds, heatmapWidth = 250, heatmapHeight = 250) {\n  // 注意：mergedGeometryBounds 是经过完整变换流程后的最终边界框\n  // 包括：1. 应用各自变换矩阵 2. 合并几何体 3. X轴90度旋转\n  \n  const bounds = mergedGeometryBounds\n  const roomX = bounds.max.x - bounds.min.x\n  const roomY = bounds.max.y - bounds.min.y\n  \n  // 对输入坐标应用相同的X轴90度旋转变换\n  // makeRotationX(Math.PI / 2): (x,y,z) -> (x,z,-y)\n  const transformedX = x  // X轴不变\n  const transformedY = z  // 原来的Z轴变为新的Y轴\n  \n  // 使用resetUV函数的完全相同逻辑计算UV\n  const u = roomX > 0 ? (transformedX - bounds.min.x) / roomX : 0\n  const v = roomY > 0 ? (transformedY - bounds.min.y) / roomY : 0\n  \n  // 转换为canvas坐标（与buildingsHeatmap.vue第105行完全一致）\n  const canvasX = u * heatmapWidth\n  const canvasY = (1 - v) * heatmapHeight // Y轴翻转\n  \n  return { \n    u: Math.max(0, Math.min(1, u)), \n    v: Math.max(0, Math.min(1, v)),\n    canvasX: Math.max(1, Math.min(heatmapWidth, canvasX)),     // 热力图坐标从1开始\n    canvasY: Math.max(1, Math.min(heatmapHeight, canvasY)),   // 热力图坐标从1开始\n    heatmapWidth, \n    heatmapHeight \n  }\n}\n\n// 仿射变换系数\nconst affineCoeffs = {\n  a1: 0.00001006, b1: -0.00000390, c1: 31.23983629,\n  a2: -0.00000448, b2: -0.00001147, c2: 121.48174635\n}",
  "exportTime": "2025-08-08T12:56:10.929Z",
  "version": "1.0"
}